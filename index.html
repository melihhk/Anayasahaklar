
<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Karton ‚Äì Mahkeme E≈üle≈ütirme Oyunu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Mobilde uygulama gibi a√ßƒ±lsƒ±n -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
      background: radial-gradient(circle at top, #0d1525 0%, #05080f 60%, #000 100%);
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      min-height: 100vh;
    }

    .app {
      width: 100%;
      max-width: 520px;
      min-height: 100vh;
      margin: 0 auto;
      padding: calc(env(safe-area-inset-top, 0px) + 16px) 16px calc(env(safe-area-inset-bottom, 0px) + 20px);
      background: linear-gradient(150deg, rgba(11,15,22,0.98), rgba(12,18,30,0.96));
      border-radius: 0;
      box-shadow: 0 0 0 rgba(0,0,0,0.0);
      border-left: 1px solid rgba(31,41,55,0.85);
      border-right: 1px solid rgba(31,41,55,0.85);
    }

    @media (min-width: 768px) {
      .app {
        margin-top: 18px;
        margin-bottom: 18px;
        border-radius: 20px;
        box-shadow: 0 24px 70px rgba(0,0,0,0.85);
      }
    }

    h1 {
      margin: 0 0 4px;
      font-size: 20px;
      text-align: center;
      color: #f9fafb;
      letter-spacing: 0.04em;
    }

    .subtitle {
      text-align: center;
      font-size: 13px;
      color: #9ca3af;
      margin-bottom: 14px;
    }

    .subtitle strong {
      color: #e5e7eb;
    }

    .top-info {
      display: flex;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    .info-pill {
      padding: 5px 9px;
      border-radius: 999px;
      background: rgba(15,23,42,0.96);
      border: 1px solid rgba(55,65,81,0.9);
      font-size: 11px;
      color: #cbd5f5;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .info-pill .val {
      font-weight: 600;
      color: #e5e7eb;
    }

    .question-card {
      background: linear-gradient(135deg, #131a29 0%, #090d14 100%);
      border-radius: 16px;
      padding: 12px 12px 14px;
      border: 1px solid rgba(75,85,99,0.7);
      margin-bottom: 12px;
      box-shadow: inset 0 0 18px rgba(0,0,0,0.55);
      position: relative;
      overflow: hidden;
    }

    /* Hafif aura efekti */
    .question-card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at top, rgba(59,130,246,0.10), transparent 60%),
        radial-gradient(circle at bottom, rgba(147,51,234,0.10), transparent 60%);
      opacity: 0.85;
      pointer-events: none;
    }

    .question-card::after {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      border: 1px solid rgba(148,163,184,0.45);
      box-shadow:
        0 0 18px rgba(15,23,42,0.9),
        0 0 32px rgba(37,99,235,0.25);
      pointer-events: none;
    }

    .question-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #9ca3af;
      margin-bottom: 4px;
      position: relative;
      z-index: 1;
    }

    /* Havalƒ±, neon, animasyonlu karton adƒ± */
    .question-text {
      position: relative;
      z-index: 1;
      font-size: 20px;
      font-weight: 800;
      letter-spacing: 0.03em;
      text-align: center;

      background: linear-gradient(120deg, #e5e7eb, #60a5fa, #a855f7, #e5e7eb);
      background-size: 220% 220%;
      -webkit-background-clip: text;
      color: transparent;

      text-shadow:
        0 0 8px rgba(37,99,235,0.45),
        0 0 18px rgba(59,130,246,0.35);

      animation:
        glowPulse 2.4s ease-in-out infinite,
        textShine 6s linear infinite;
      transition: transform 0.18s ease-out, opacity 0.18s ease-out;
    }

    @keyframes glowPulse {
      0%   { text-shadow: 0 0 6px rgba(59,130,246,0.4), 0 0 16px rgba(37,99,235,0.3); transform: scale(1); }
      50%  { text-shadow: 0 0 10px rgba(129,140,248,0.8), 0 0 22px rgba(59,130,246,0.7); transform: scale(1.03); }
      100% { text-shadow: 0 0 6px rgba(59,130,246,0.4), 0 0 16px rgba(37,99,235,0.3); transform: scale(1); }
    }

    @keyframes textShine {
      0%   { background-position: 0% 50%; }
      50%  { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .fade-in-up {
      animation: fadeInUp 0.25s ease-out;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(6px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Yeni kart veya tam isabette tek seferlik pop */
    .question-text.pop {
      animation:
        popOnce 0.35s ease-out,
        glowPulse 2.4s ease-in-out infinite,
        textShine 6s linear infinite;
    }

    @keyframes popOnce {
      0%   { transform: scale(0.9); opacity: 0; }
      40%  { transform: scale(1.08); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }

    .question-note {
      font-size: 11px;
      color: #cbd5f5;
      margin-top: 4px;
      position: relative;
      z-index: 1;
    }

    /* Patlama efekti */
    .burst {
      position: absolute;
      inset: -10px;
      background:
        radial-gradient(circle at center,
          rgba(248,250,252,0.9),
          rgba(59,130,246,0.45) 35%,
          transparent 65%);
      mix-blend-mode: screen;
      pointer-events: none;
      animation: burst 0.5s ease-out forwards;
      z-index: 0;
    }

    @keyframes burst {
      0%   { transform: scale(0.4); opacity: 0.95; }
      60%  { transform: scale(1.1); opacity: 0.7; }
      100% { transform: scale(1.5); opacity: 0; }
    }

    .hint {
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 8px;
      text-align: center;
    }

    .hint strong {
      color: #e5e7eb;
    }

    .unit-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      margin-bottom: 10px;
    }

    .unit-btn {
      border: 1px solid rgba(60,70,95,0.7);
      border-radius: 999px;
      padding: 9px 10px;
      font-size: 12px;
      background: rgba(20,25,40,0.92);
      color: #e5e7eb;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      gap: 6px;
      transition:
        background 0.12s ease,
        border-color 0.12s ease,
        box-shadow 0.12s ease,
        transform 0.08s ease,
        opacity 0.12s ease;
      min-height: 36px;
      backdrop-filter: blur(6px);
    }

    .unit-btn span.short {
      font-weight: 600;
    }

    .unit-btn span.full {
      font-size: 10px;
      color: #9ca3af;
    }

    .unit-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 14px rgba(0,0,0,0.8);
      border-color: rgba(59,130,246,0.9);
    }

    .unit-btn.correct-selected {
      background: radial-gradient(circle at top, #16a34a, #166534);
      border-color: rgba(74,222,128,1);
      box-shadow: 0 0 16px rgba(34,197,94,0.9);
      color: #ecfdf3;
      transform: translateY(-1px);
    }

    .unit-btn.correct-reveal {
      background: radial-gradient(circle at top, #22c55e, #15803d);
      border-color: rgba(190,242,100,0.95);
      box-shadow: 0 0 20px rgba(190,242,100,0.8);
      color: #ecfdf3;
    }

    .unit-btn.dimmed {
      opacity: 0.45;
    }

    .unit-btn.wrong-flash {
      background: linear-gradient(145deg, #5e0f0f, #7f1d1d);
      border-color: rgba(239,68,68,1);
      box-shadow: 0 0 16px rgba(239,68,68,0.8);
    }

    @keyframes shake {
      0%   { transform: translateX(0); }
      20%  { transform: translateX(-4px); }
      40%  { transform: translateX(4px); }
      60%  { transform: translateX(-4px); }
      80%  { transform: translateX(4px); }
      100% { transform: translateX(0); }
    }

    .shake {
      animation: shake 0.4s ease;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-top: 8px;
      margin-bottom: 10px;
    }

    .btn-small {
      border: 1px solid rgba(55,65,81,0.9);
      border-radius: 999px;
      padding: 10px 18px;
      font-size: 13px;
      font-weight: 600;
      background: radial-gradient(circle at top, #020617, #020617);
      color: #e5e7eb;
      cursor: pointer;
      min-width: 150px;
      text-align: center;
      transition:
        background 0.15s ease,
        border-color 0.15s ease,
        box-shadow 0.15s ease,
        transform 0.1s ease;
    }

    .btn-small.primary {
      border-color: rgba(59,130,246,1);
      background: linear-gradient(120deg, #1d4ed8, #7c3aed);
      box-shadow: 0 0 14px rgba(59,130,246,0.6);
      color: #f9fafb;
      animation: btnPulse 2.2s infinite;
    }

    @keyframes btnPulse {
      0%   { box-shadow: 0 0 0 0 rgba(59,130,246,0.7); }
      70%  { box-shadow: 0 0 0 16px rgba(59,130,246,0); }
      100% { box-shadow: 0 0 0 0 rgba(59,130,246,0); }
    }

    .btn-small:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.9);
      border-color: rgba(96,165,250,0.95);
    }

    .message {
      margin-top: 6px;
      font-size: 12px;
      text-align: center;
      color: #a5b4fc;
    }

    .message span {
      display: block;
      margin-top: 2px;
      font-size: 11px;
      color: #9ca3af;
    }
  </style>
</head>
<body>
<div class="app">
  <h1>Karton ‚Äì Mahkeme E≈üle≈ütirme</h1>
  <div class="subtitle">
    Ekrandaki kartonun <strong>hangi mahkeme/birimlerde</strong> olduƒüunu tahmin et.
  </div>

  <div class="top-info">
    <div class="info-pill">
      üß† Toplam karton: <span class="val" id="info-total">0</span>
    </div>
    <div class="info-pill">
      ‚úÖ Tam isabet: <span class="val" id="info-perfect">0</span>
    </div>
    <div class="info-pill">
      üîÅ Soru: <span class="val" id="info-question">0</span>
    </div>
  </div>

  <div class="question-card">
    <div class="question-label">Karton</div>
    <div class="question-text fade-in-up" id="question-text">
      Ba≈ülamak i√ßin bir karton y√ºkleniyor...
    </div>
    <div class="question-note">
      Bu kartonun bulunduƒüu mahkeme/birimleri a≈üaƒüƒ±dan se√ß. Yanlƒ±≈ü sekme <strong>titreyerek</strong> uyarƒ±r.
    </div>
  </div>

  <div class="hint">
    Karton hangi ba≈ülƒ±klarda varsa o sekmeleri i≈üaretle. Emin deƒüilsen √∂nce tahmin et, sonra <strong>Doƒürularƒ± G√∂ster</strong>.
  </div>

  <div class="unit-grid" id="unit-grid">
    <button class="unit-btn" data-unit="bam_cbs">
      <span class="short">BAM CBS</span>
      <span class="full">B√∂lge Adliye CBS</span>
    </button>
    <button class="unit-btn" data-unit="adli_cbs">
      <span class="short">Adli CBS</span>
      <span class="full">Adli Yargƒ± Cumhuriyet Ba≈üsavcƒ±lƒ±ƒüƒ±</span>
    </button>
    <button class="unit-btn" data-unit="bam_ceza">
      <span class="short">BAM Ceza</span>
      <span class="full">B√∂lge Adliye Ceza Daireleri</span>
    </button>
    <button class="unit-btn" data-unit="ilk_ceza">
      <span class="short">ƒ∞lk Ceza</span>
      <span class="full">ƒ∞lk Derece Ceza Mah./H√¢kimlik</span>
    </button>
    <button class="unit-btn" data-unit="bam_hukuk">
      <span class="short">BAM Hukuk</span>
      <span class="full">B√∂lge Adliye Hukuk Daireleri</span>
    </button>
    <button class="unit-btn" data-unit="ilk_hukuk">
      <span class="short">ƒ∞lk Hukuk</span>
      <span class="full">ƒ∞lk Derece Hukuk Mahkemeleri</span>
    </button>
    <button class="unit-btn" data-unit="bam_komisyon">
      <span class="short">BAM Kom.</span>
      <span class="full">B√∂lge Adliye Komisyonu</span>
    </button>
    <button class="unit-btn" data-unit="ilk_komisyon">
      <span class="short">ƒ∞lk Kom.</span>
      <span class="full">ƒ∞lk Derece Adalet Komisyonu</span>
    </button>
  </div>

  <div class="controls">
    <button class="btn-small primary" id="btn-show">Doƒürularƒ± G√∂ster</button>
    <button class="btn-small" id="btn-next">Sonraki Karton</button>
  </div>

  <div class="message" id="message"></div>
</div>

<script>
  // T√ºm birimlerin karton listeleri
  const UNITS = {
    bam_cbs: {
      key: "bam_cbs",
      title: "BAM CBS",
      items: [
        "Esas kaydƒ±",
        "ƒ∞stinabe kaydƒ±",
        "Su√ß e≈üyasƒ± kaydƒ±",
        "Yakalama kaydƒ±",
        "Temyiz kaydƒ±",
        "Cumhuriyet savcƒ±sƒ± bilgi kaydƒ±",
        "Kitaplƒ±k kaydƒ±",
        "Dava nakil istekleri kaydƒ±",
        "Tebliƒüname kaydƒ±",
        "Uyu≈ümazlƒ±ƒüƒ±n giderilmesi ba≈üvuru kaydƒ±",
        "Zimmet kaydƒ±",
        "Muhabere kaydƒ±",
        "Disiplin soru≈üturma kaydƒ±",
        "Tefti≈ü kaydƒ±",
        "Bilgi edinme kaydƒ±"
      ]
    },
    adli_cbs: {
      key: "adli_cbs",
      title: "Adli Yargƒ± CBS",
      items: [
        "Esas kaydƒ±",
        "Soru≈üturma kaydƒ±",
        "ƒ∞stinabe kaydƒ±",
        "Su√ß e≈üyasƒ± kaydƒ±",
        "Yakalama kaydƒ±",
        "Temyiz kaydƒ±",
        "Cumhuriyet savcƒ±sƒ± bilgi kaydƒ±",
        "Kitaplƒ±k kaydƒ±",
        "√ñl√º muayenesi ve otopsi kaydƒ±",
        "Bilirki≈üi kaydƒ±",
        "Terc√ºman kaydƒ±",
        "Uzla≈üma kaydƒ±",
        "√ñn√∂deme kaydƒ±",
        "SEGBƒ∞S kaydƒ±",
        "Ailenin korunmasƒ± kararlarƒ±nƒ±n kaydƒ±",
        "ƒ∞nfaz kaydƒ±",
        "Denetimli serbestlik kaydƒ±",
        "Hapis ile tazyik kaydƒ±",
        "Tazyik hapsi kaydƒ±",
        "Disiplin hapsi kaydƒ±",
        "ƒ∞dari yaptƒ±rƒ±m kararlarƒ±nƒ±n kaydƒ±",
        "Zimmet kaydƒ±",
        "Muhabere kaydƒ±"
      ]
    },
    bam_ceza: {
      key: "bam_ceza",
      title: "BAM Ceza Dairesi",
      items: [
        "Esas kaydƒ±",
        "Duru≈üma ve ke≈üif g√ºnleri kaydƒ±",
        "Karar kaydƒ±",
        "SEGBƒ∞S kaydƒ±",
        "ƒ∞stinabe kaydƒ±",
        "Temyiz kaydƒ±",
        "Deƒüi≈üik i≈üler kaydƒ±",
        "Ta≈üra temyiz kaydƒ±",
        "Dava nakil istekleri kaydƒ±",
        "Daƒüƒ±tƒ±m kaydƒ±",
        "Uyu≈ümazlƒ±ƒüƒ±n giderilmesi ba≈üvuru kaydƒ±",
        "Zimmet kaydƒ±",
        "Muhabere kaydƒ±",
        "Disiplin soru≈üturma kaydƒ±",
        "Tefti≈ü kaydƒ±",
        "Bilgi edinme kaydƒ±"
      ]
    },
    ilk_ceza: {
      key: "ilk_ceza",
      title: "ƒ∞lk Derece Ceza Mah./H√¢kimlik",
      items: [
        "Esas kaydƒ±",
        "Duru≈üma g√ºnleri kaydƒ±",
        "Ke≈üif g√ºnleri kaydƒ±",
        "Karar kaydƒ±",
        "SEGBƒ∞S kaydƒ±",
        "ƒ∞stinabe kaydƒ±",
        "Temyiz kaydƒ±",
        "Deƒüi≈üik i≈üler kaydƒ±",
        "ƒ∞ddianamenin deƒüerlendirilmesi kaydƒ±",
        "Uzla≈üma kaydƒ±",
        "√ñn√∂deme kaydƒ±",
        "Bilirki≈üilik kaydƒ±",
        "Terc√ºman kaydƒ±",
        "ƒ∞stinaf kaydƒ±",
        "ƒ∞nfaz h√¢kimliƒüi kaydƒ±",
        "Koruyucu ve destekleyici tedbir kararlarƒ± kaydƒ±",
        "Sorgu kaydƒ±",
        "Muhabere kaydƒ±",
        "Zimmet kaydƒ±"
      ]
    },
    bam_hukuk: {
      key: "bam_hukuk",
      title: "BAM Hukuk Dairesi",
      items: [
        "Vezne kaydƒ±",
        "Esas kaydƒ±",
        "Karar kaydƒ±",
        "ƒ∞stinabe kaydƒ±",
        "Temyiz kaydƒ±",
        "Dava nakil istekleri kaydƒ±",
        "Uyu≈ümazlƒ±ƒüƒ±n giderilmesi ba≈üvuru kaydƒ±",
        "Daƒüƒ±tƒ±m kaydƒ±",
        "Deƒüi≈üik i≈üler kaydƒ±",
        "Posta mutemet kaydƒ±",
        "Zimmet kaydƒ±",
        "Ta≈üra temyiz kaydƒ±",
        "Muhabere kaydƒ±",
        "Kƒ±ymetli evrak ve e≈üya kaydƒ±",
        "Disiplin soru≈üturma kaydƒ±",
        "Har√ß tahsil m√ºzekkeresi kaydƒ±",
        "Tefti≈ü kaydƒ±",
        "Sosyal inceleme-g√∂r√º≈üme raporlarƒ± kaydƒ±",
        "Bilgi edinme kaydƒ±",
        "Duru≈üma ve ke≈üif g√ºnleri kaydƒ±"
      ]
    },
    ilk_hukuk: {
      key: "ilk_hukuk",
      title: "ƒ∞lk Derece Hukuk Mahkemeleri",
      items: [
        "Esas kaydƒ±",
        "Karar kaydƒ±",
        "ƒ∞stinabe kaydƒ±",
        "Temyiz kaydƒ±",
        "Deƒüi≈üik i≈üler kaydƒ±",
        "Posta mutemet kaydƒ±",
        "Ta≈üra istinaf veya temyiz kaydƒ±",
        "Kƒ±ymetli evrak ve e≈üya kaydƒ±",
        "Har√ß tahsil m√ºzekkeresi kaydƒ±",
        "Sosyal inceleme-g√∂r√º≈üme kaydƒ±",
        "Duru≈üma g√ºnleri kaydƒ±",
        "Ke≈üif g√ºnleri kaydƒ±",
        "ƒ∞stinaf kaydƒ±",
        "Ortaklƒ±ƒüƒ±n giderilmesi satƒ±≈ü paralarƒ± kasa kaydƒ±",
        "Ortaklƒ±ƒüƒ±n giderilmesi dosyalarƒ±na mahsus esas kaydƒ±",
        "Tereke esas kaydƒ±",
        "Tereke karar kaydƒ±",
        "Tereke kasa kaydƒ±",
        "Mirasƒ± ret kaydƒ±",
        "Posta mutemet kaydƒ±",
        "Tevzi kaydƒ±",
        "Har√ß tahsil m√ºzekkeresi zimmet kaydƒ±",
        "Vakƒ±f tescil kaydƒ±",
        "Vesayet adƒ± kaydƒ±",
        "Muhabere kaydƒ±",
        "Hakem kararlarƒ± saklama kaydƒ±",
        "Bilgi edinme kaydƒ±"
      ]
    },
    bam_komisyon: {
      key: "bam_komisyon",
      title: "BAM Komisyonu",
      items: [
        "√ñzl√ºk kaydƒ±",
        "Karar kaydƒ±",
        "Personel n√∂bet kaydƒ±",
        "Genelge ve g√∂r√º≈ü kaydƒ±",
        "Duyuru kaydƒ±",
        "Fazla ve esnek √ßalƒ±≈üma kaydƒ±",
        "H√¢kim bilgi kaydƒ±",
        "Komisyon g√ºndem kaydƒ±",
        "Bilirki≈üi listesi kaydƒ±",
        "Sƒ±nav kaydƒ±",
        "Dava i≈üleri kaydƒ±",
        "Zimmet kaydƒ±",
        "Muhabere kaydƒ±",
        "Disiplin soru≈üturma kaydƒ±",
        "Tefti≈ü kaydƒ±",
        "Bilgi edinme kaydƒ±"
      ]
    },
    ilk_komisyon: {
      key: "ilk_komisyon",
      title: "ƒ∞lk Derece Adalet Komisyonu",
      items: [
        "√ñzl√ºk kaydƒ±",
        "Karar kaydƒ±",
        "Personel n√∂bet kaydƒ±",
        "Genelge ve g√∂r√º≈ü kaydƒ±",
        "Duyuru kaydƒ±",
        "Fazla ve esnek √ßalƒ±≈üma kaydƒ±",
        "H√¢kim bilgi kaydƒ±",
        "Komisyon g√ºndem kaydƒ±",
        "Bilirki≈üi ve terc√ºman listesi kaydƒ±",
        "Sƒ±nav kaydƒ±",
        "Dava i≈üleri kaydƒ±",
        "H√¢kim ve savcƒ± adaylarƒ± kaydƒ±",
        "Avukat stajyerleri kaydƒ±",
        "Lojman kaydƒ±",
        "Tasdik ≈üerhi kaydƒ±",
        "Zimmet kaydƒ±",
        "Muhabere kaydƒ±",
        "Disiplin soru≈üturma kaydƒ±",
        "Tefti≈ü kaydƒ±",
        "Bilgi edinme kaydƒ±"
      ]
    }
  };

  const questionTextEl = document.getElementById("question-text");
  const questionCardEl = document.querySelector(".question-card");
  const unitButtons = Array.from(document.querySelectorAll(".unit-btn"));
  const btnShow = document.getElementById("btn-show");
  const btnNext = document.getElementById("btn-next");
  const msgEl = document.getElementById("message");
  const infoTotalEl = document.getElementById("info-total");
  const infoPerfectEl = document.getElementById("info-perfect");
  const infoQuestionEl = document.getElementById("info-question");

  // karton adƒ± -> hangi unit'lerde var
  const cardToUnits = new Map();

  function buildCardMap() {
    Object.values(UNITS).forEach(unit => {
      unit.items.forEach(name => {
        if (!cardToUnits.has(name)) {
          cardToUnits.set(name, new Set());
        }
        cardToUnits.get(name).add(unit.key);
      });
    });
  }

  buildCardMap();

  const allCards = Array.from(cardToUnits.keys());
  infoTotalEl.textContent = String(allCards.length);

  let questionOrder = [];
  let currentIndex = 0;
  let currentCard = null;
  let perfectCount = 0;
  let questionCount = 0;

  function shuffle(array) {
    const a = [...array];
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  function prepareQuestions() {
    questionOrder = shuffle(allCards);
    currentIndex = 0;
  }

  function resetButtonStates() {
    unitButtons.forEach(btn => {
      btn.classList.remove(
        "correct-selected",
        "correct-reveal",
        "dimmed",
        "wrong-flash",
        "shake"
      );
      btn.dataset.selected = "false";
    });
  }

  function showNewCard() {
    if (questionOrder.length === 0 || currentIndex >= questionOrder.length) {
      prepareQuestions();
    }
    currentCard = questionOrder[currentIndex];
    currentIndex++;
    questionCount++;
    infoQuestionEl.textContent = String(questionCount);

    resetButtonStates();
    msgEl.textContent = "";

    questionTextEl.classList.remove("fade-in-up", "pop");
    void questionTextEl.offsetWidth; // trigger reflow
    questionTextEl.textContent = currentCard;
    questionTextEl.classList.add("fade-in-up", "pop");
  }

  function handleUnitClick(btn) {
    if (!currentCard) return;

    const unitKey = btn.dataset.unit;
    const correctUnits = cardToUnits.get(currentCard) || new Set();

    if (btn.classList.contains("correct-selected")) return;

    if (correctUnits.has(unitKey)) {
      btn.classList.add("correct-selected");
      btn.dataset.selected = "true";
    } else {
      btn.classList.add("shake", "wrong-flash");
      setTimeout(() => {
        btn.classList.remove("shake", "wrong-flash");
      }, 420);
    }
  }

  function triggerExplosion() {
    if (!questionCardEl) return;
    const burst = document.createElement("div");
    burst.className = "burst";
    questionCardEl.appendChild(burst);
    questionTextEl.classList.remove("pop");
    void questionTextEl.offsetWidth;
    questionTextEl.classList.add("pop");
    setTimeout(() => {
      burst.remove();
    }, 520);
  }

  function showAnswer() {
    if (!currentCard) return;
    const correctUnits = cardToUnits.get(currentCard) || new Set();

    let allCorrectChosen = true;

    unitButtons.forEach(btn => {
      const key = btn.dataset.unit;
      const isCorrect = correctUnits.has(key);
      const isSelected = btn.classList.contains("correct-selected");

      if (isCorrect && !isSelected) {
        btn.classList.add("correct-reveal");
        allCorrectChosen = false;
      } else if (!isCorrect && isSelected) {
        btn.classList.add("dimmed");
        allCorrectChosen = false;
      } else if (!isCorrect && !isSelected) {
        btn.classList.add("dimmed");
      }
    });

    if (allCorrectChosen) {
      perfectCount++;
      infoPerfectEl.textContent = String(perfectCount);
      msgEl.innerHTML =
        "üéâ Tam isabet! Bu kartonun olduƒüu t√ºm ba≈ülƒ±klarƒ± doƒüru se√ßtin.<span>Patlamayƒ± g√∂r√ºp yeni kartona ge√ß!</span>";
      triggerExplosion();
    } else {
      msgEl.innerHTML =
        "üìù Bazƒ± yerler eksik ya da fazla. Ye≈üil parlayan sekmeler bu kartonun ge√ßtiƒüi ba≈ülƒ±klar.<span>Bunlarƒ± not al, sonra yeni karta ge√ß.</span>";
    }
  }

  unitButtons.forEach(btn => {
    btn.addEventListener("click", () => handleUnitClick(btn));
  });

  btnShow.addEventListener("click", showAnswer);
  btnNext.addEventListener("click", showNewCard);

  prepareQuestions();
  showNewCard();
</script>
</body>
</html>
